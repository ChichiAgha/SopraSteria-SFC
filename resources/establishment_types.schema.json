{
    "$id" : "establishment_types.schema.json",
	"description" : "Describes the entities used in Establishments API; in both the requests and responses.",
	"title" : "ASCWDS Establishment API Schema - Primary Types",
	"definitions" : {
        "id" : {
            "type" : "integer",
            "minimum" : 0
        },
        "Username" : {
            "type" : "string",
            "minLength": 3,
            "maxLength": 120
        },
        "Password" : {
            "type" : "string",
            "minLength": 8,
            "maxLength": 120
        },
        "Fullname" : {
            "description" : "The fullname of a user",
            "type" : "string",
            "minLength" : 3,
            "maxLength": 120
        },
        "Address" : {
            "description" : "Concatenated address - excluding postcode",
            "type" : "string",
            "minLength" : 3,
            "maxLength" : 120
        },
        "Postcode" : {
            "description": "A UK postcode",
            "type": "string",
            "pattern" : "([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\s?[0-9][A-Za-z]{2})"
        },
        "LocationRef" : {
            "description" : "A unique reference associated to an Establishment",
            "type" : "string",
            "minLength": 8,
            "maxLength": 12
        },
        "EstablishmentName" : {
            "description": "the name of the Establishment",
            "type" : "string",
            "minLength" : 3,
            "maxLength": 120
        },
        "ServiceName" : {
            "description": "the name of the Service",
            "type" : "string",
            "minLength" : 3,
            "maxLength": 120
        },
        "ServiceCategory" : {
            "description": "the category associated with the Service",
            "type" : "string",
            "minLength" : 3,
            "maxLength": 120
        },
		"EmployerType" : {
			"description" : "The type of employer",
			"type" : "object",
			"properties" : {
				"value" : {
					"description" : "the textual representation of Employer; enumerated because known values",
                    "type" : "string",
                    "enum" : ["Private Sector", "Voluntary or Charity", "Other"]
				},
				"id" : {
					"description" : "Optional integer representing the employer type: 1=Private, 2=Voluntary, 3=Other",
					"$ref" : "#/definitions/ID"
				}
			},
			"required" : ["value"]
        },
        "ServiceCapacity" : {
            "description" : "Optionally associated to a Service, is one or more questions around capacity",
            "type" : "object",
            "properties" : {
                "id": {
                    "description" : "the unique reference of the service capacity",
                    "$ref" : "#/definitions/ID"
                },
                "sequence" : {
                    "description" : "if there is more than one capacity question, this sequence defines the order in which they should be prompted",
                    "type" : "number",
                    "minimum": 1
                },
                "question" : {
                    "description": "The capacity question context",
                    "type" : "string",
                    "minLength" : 3
                },
                "answer" : {
                    "description": "Optional: If a known establishment, the answer to this capacity question",
                    "type" : "integer",
                    "minimum": 0
                }
            }
        },
        "Service" : {
            "description" : "The Service that can be performed at an Establishment",
            "properties" : {
                "id" : {
                    "description" : "the unique reference of the service type",
                    "$ref" : "#/definitions/ID"
                },
                "name" : {
                    "description" : "the display name of the service type",
                    "$ref" : "#/definitions/ServiceName"
                },
                "category" : {
                    "description"  : "the category of this service",
                    "$ref" : "#/definitions/ServiceCategory"
                },
                "isCQC" : {
                    "description": "if true, this service is defined by CQC",
                    "type" : "boolean"
                },
                "isMyService" : {
                    "description" : "optional flag that when true identifies this service being one of the services provided by the Establishment (returned by api/myServices)",
                    "type" : "boolean"
                },
                "capacity" : {
                    "description" : "optional set of capacity questions and, if relevant (associated to a known Establishment), the answers",
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/ServiceCapacity"
                    },
                    "minItems" : 1
                }
            },
            "required" : ["id"]
        },
        "ServiceGroup" : {
            "description" : "A collection of services having the same cateogory",
            "type" : "object",
            "properties" : {
                "category" : {
                    "$ref" : "#/definitions/ServiceCategory"
                },
                "services" : {
                    "description" : "All the services attributed to this service category",
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/Service"
                    },
                    "minItems": 1
                }
            }
        },
        "Establishment" : {
            "description" : "A physical location offering care services; can be commercial or private location",
            "type" : "object",
            "properties" : {
                "id" : {
                    "description" : "The unique reference for this estasblishment",
                    "$ref" : "#/definitions/ID"
                },
                "name" : {
                    "description" : "The given name ofthis establishment",
                    "$ref" : "#/definitions/EstablishmentName"
                },
                "address" : {
                    "description": "The given (concatenated) address of this establishment",
                    "$ref" : "#/definitions/Address"
                },
                "postcode" : {
                    "description": "The given postcode of this establishment",
                    "$ref" : "#/definitions/Postcode"
                },
                "locationRef" : {
                    "description": "An optional reference ",
                    "$ref" : "#/definitions/LocationRef"
                },
                "isRegulated" : {
                    "description": "True if this establishment is regulated by CQC",
                    "type": "boolean"
                },
                "mainService" : {
                    "description" : "(Optionally), the primary service associated with this Establishment",
                    "$ref" : "#/definitions/Service"
                },
                "employerType" : {
                    "description": "The type of the employer",
                    "$ref" : "#/definitions/EmployerType"
                },
                "otherServices" : {
                    "description": "Optionally, the establishment can be associated with more than just the main service",
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/ServiceGroup"
                    }
                },
                "allOtherServices" : {
                    "description": "Optionally, the list of all services available to this Establishment based on CQC (isRegistered), with those services already associated to this Establishment highlighted",
                    "type" : "array",
                    "items" : {
                        "$ref" : "#/definitions/ServiceGroup"
                    }
                },
                "share": {
                    "description" : "Whether to share, and if so, the share options (LA/CQC)",
                    "$ref" : "#/definitions/ShareOptions"
                },
                "numberOfStaff" : {
                    "description" : "The number of staff reported at this Establishment",
                    "type" : "integer",
                    "minimum": 0,
                    "maximum": 999
                }
            },
            "required" : ["id", "name"]
        }
    }
}