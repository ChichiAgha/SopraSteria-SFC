<div class="main-page-container col-12">
  <div id="back" class="back-link">
    <a routerLink="/worker/start-screen"> <span class="arrow"></span>Back </a>
  </div>

  <app-error-summary
    *ngIf="form.errors?.addMoreRecords"
    [errors]="form.errors.addMoreRecords">
  </app-error-summary>

  <app-error-summary
    *ngIf="form.errors?.removeRecords"
    [errors]="form.errors.removeRecords">
  </app-error-summary>

  <form novalidate (ngSubmit)="submitHandler()" [formGroup]="form">
    <h1 class="h1">Create your staff records</h1>

    <div class="form-group">
      <div class="field-group mb-5">
        <label>
          Total number of staff
          <div *ngIf="form.controls.totalStaff.errors?.min || form.controls.totalStaff.errors?.max" class="alert alert-danger">
            <p class="pt-4">Total number of staff must be between 0 and 999</p>
          </div>
          <span class="example">This includes permanent, temporary, pool/bank or agency staff</span>
          <input
            type="number"
            formControlName="totalStaff"
            min="1"
            max="999"
            step="1"
            class="form-control"
            [ngClass]="{
              'is-invalid':
                (form.get('totalStaff').touched || form.get('totalStaff').dirty) && !form.get('totalStaff').valid
            }"
          />
        </label>
      </div>
    </div>

    <h3 class="h2 pb-2">Information about your staff</h3>
    <div formArrayName="staffRecords" class="staff-records">
      <div class="row staff-record fs-19" *ngFor="let staffRecord of form.get('staffRecords').controls; let i = index" [formGroupName]="i">
        <div class="tb-cell col-2 pt-4 pb-4 pr-2">
          <strong>Staff record {{ i + 1 }}</strong>
        </div>
        <div class="tb-cell col-4 pt-4 pb-4 pr-2">
          {{ staffRecord.get('nameOrId').value }}
        </div>
        <div class="tb-cell col-4 pt-2 pb-0 pr-2">
          <button type="button" class="btn btn-link" (click)="deleteStaffRecord(i)">Delete</button>
        </div>
        <div class="tb-cell text-right col-2 pt-2 pb-0">
          <button *ngIf="!staffRecord.get('active').value" type="button" class="btn btn-link"  (click)="openStaffRecord(i)">Change</button>
        </div>

        <div class="form-group border-line-top" *ngIf="staffRecord.get('active').value">
          <div class="field-group mb-5">
            <label class="col-12 col-md-11 col-lg-8">
              Full name or ID number?
              <div *ngIf="staffRecord.controls.nameOrId.errors && staffRecord.controls.nameOrId.touched" class="alert alert-danger">
                <p>Enter a full name or ID number</p>
              </div>
              <input type="text" formControlName="nameOrId" maxlength="50" class="form-control col-12" />
            </label>
          </div>

          <div class="field-group mb-5">
            <label>
              What is their main job role?
              <div *ngIf="staffRecord.controls.mainJob.errors && staffRecord.controls.mainJob.touched" class="alert alert-danger">
                <p>Select a job role</p>
              </div>
              <select formControlName="mainJob" class="form-control">
                <option [ngValue]="null">Select Main Job Role</option>
                <option *ngFor="let job of jobsAvailable" [value]="job.id">
                  {{ job.title }}
                </option>
              </select>
            </label>
          </div>

          <div class="field-group mb-5">
            <label class="d-block">
              What type of contract do they have?
              <div *ngIf="staffRecord.controls.contract.errors && staffRecord.controls.contract.touched" class="alert alert-danger">
                <p>Select a contract type</p>
              </div>
            </label>
            <div *ngFor="let contract of contractsAvailable; let i = index" class="multiple-choice">
              <input
                type="radio"
                formControlName="contract"
                class="form-control"
                [value]="contract"
                id="contract-type-{{ i }}"
              />
              <label for="contract-type-{{ i }}">{{ contract }}</label>
            </div>
          </div>

          <button type="button" class="btn btn-blue" (click)="validateRecord(i)">Continue</button>
        </div>
      </div>
    </div>

    <a *ngIf="!displayAddMore" (click)="addStaffRecord()">+ Add another staff record</a>

    <div class="btn-container container">
      <div class="row">
        <button type="submit" class="btn btn-primary">Save and continue</button>
      </div>
    </div>
  </form>
</div>
